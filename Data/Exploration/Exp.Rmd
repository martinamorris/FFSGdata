---
title: "Exploration before Exploitation"
output: html_notebook
---
## Summary ##
We will work on the following issues in order to get a
better picture of the data that we are working with before
creating any statistical models:
  - Variable Identification
  - Univariate Analysis
  - Bi-variate Analysis
  - Missing values treatment
  - Outlier treatment
  - Variable transformation
  - Variable creation

## Exploration cleaning (must be in trivial amounts only here) ##
Remove the non-police killings from Fatal encounters  
```{r}
library(dplyr)
fe.clean <- filter(fe.clean, fe.clean$kbp.filter == "killed by police")
```

## Number of records worth matching ##
First, we determine the number of records that can potentially be matched. These are the records that are
recorded when all the specified datasets are in existence. As of this writing, Killed by police is the most
recent dataset as determined by its date of creation (2013). So, we will look at numbers partitioned at 2013:
```{r}
library(plotly)
fe_num_records_before_2013 <- nrow(filter(fe.clean, fe.clean$year < 2013))
kbp_num_records_before_2013 <- nrow(filter(kbp, kbp$year < 2013))
fe_num_records_after_2013 <- nrow(filter(fe.clean, fe.clean$year >= 2013))
kbp_num_records_after_2013 <- nrow(filter(kbp, kbp$year >= 2013))
num_record_list_before_2013 <- c(fe_num_records_before_2013, kbp_num_records_before_2013)
num_record_list_after_2013 <- c(fe_num_records_after_2013, kbp_num_records_after_2013)
dfs <- c("Fatal encounters", "Killed by Police")
data <- data.frame(dfs, num_record_list_before_2013, num_record_list_after_2013)
p <- plot_ly(data, x = ~dfs, y = ~num_record_list_before_2013, type = 'bar', name = 'Before 2013',
        marker = list(color = 'rgb(55, 83, 109)')) %>%
  add_trace(y = ~num_record_list_after_2013, name = 'After 2013', marker = list(color = 'rgb(26, 118, 255)')) %>%
    layout(title = "Number of records as partiitoned by the origin date of most recently created dataset",
           yaxis = list(title = "Number of records"), xaxis = list(title = "Dataset"), barmode = 'group', bargap = 0.15)
p
```
As seen above, we have no case reported before 2013 by Killed by Police compared to majority of Fatal encounters' data recorded before 2013. Also note that even after 2013 fatal encounters records much more than Killed by Police. Henceforth, we shall only use the data from 2013 since that is the only data worth matching.

```{r}
fe.clean <- filter(fe.clean, fe.clean$year >= 2013)
```

## Univariate Analysis for Age ##
Here we look at the age variable recorded by both datasets (albeit under different column names). **Pay special attention to warnings to figure out what needs to be cleaned in the datasets since these warnings tell age entries that are anomalous like 25-30, 17 months, 40s, etc.**

First, fatal encounters:
Total age records are
```{r}
age.fe.data <- fe.clean$age
nrow(matrix(age.fe.data))
```

Total missing age records are
```{r}
age.na.fe.data <- filter(fe.clean, is.na(fe.clean$age))
nrow(matrix(age.na.fe.data))
```


Of thte non-missing, following is the histogram of occurences.
```{r}
fe.age.data <- fe.clean$age
p <- plot_ly(x = ~fe.age.data, name = "Fatal encounters", type = "histogram")
p
```

Now, Killed by Police:
```{r}
kbp.age.data <- kbp$deceased_age
p <- plot_ly(x = ~kbp.age.data, name = "Killed by Police", type = "histogram")
p
```

Finally, both:
```{r}
fe.age.data <- fe.clean$age
kbp.age.data <- kbp$deceased_age
p <- plot_ly(alpha = 0.6) %>%
  add_histogram(x = ~fe.age.data, name = "Fatal encounters") %>%
  add_histogram(x = ~kbp.age.data, name = "Killed by Police") %>%
  layout(barmode = "overlay", xaxis = list(title = "Age"))
p
```

Notice the ages recorded as "25-30", "40s", "7 mon", etc in Fatal encounters. It is important that we clean these records if we can justify such a cleaning. Otherwise, we want our matching algorithm to be tolerant of such records.

## Univariate Analysis for Race ##
Same procedure as for age. We begin by plotting the statistics separately and then together stacked one on the top of the other.
This should allow us to see the relative density of races recorded in each dataset. More importantly, it should allow us to see the race categories encoded in the datasets and how the matching algorithm should compare them.

First, fatal encounters:
Total race records are
```{r}
race.fe.data <- data.frame(fe.clean$race)
nrow(race.fe.data)
```

Total missing age records are
```{r}
race.na.fe.data <- data.frame(filter(fe.clean, is.na(fe.clean$race)))
nrow(race.na.fe.data)
```


Of thte non-missing, following is the histogram of occurences.
```{r}
fe.race.data <- fe.clean$race
p <- plot_ly(x = ~fe.race.data, name = "Fatal encounters", type = "histogram")
p
```
<!-- TODO: -->
<!-- - general missingness -->
<!-- - missing density by date -->
<!-- - Relationship between variables -->
<!-- - Variable transformation -->

<!-- ----- Handle missing data??? ------ use the previous model ------ predict and analyze ----- Merging???? -->